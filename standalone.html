<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Odd Question Out</title>
    <style>
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    min-height: 100vh;
    color: #fff;
}

#app {
    max-width: 480px;
    margin: 0 auto;
    padding: 20px;
    min-height: 100vh;
}

.screen {
    display: none;
    animation: fadeIn 0.3s ease;
}

.screen.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

h1 {
    font-size: 2.5rem;
    text-align: center;
    margin-bottom: 10px;
}

h2 {
    font-size: 1.5rem;
    text-align: center;
    margin-bottom: 20px;
    color: #8892b0;
}

.subtitle {
    text-align: center;
    color: #8892b0;
    margin-bottom: 30px;
}

.player-input {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

input[type="text"], textarea {
    flex: 1;
    padding: 15px;
    font-size: 1rem;
    border: 2px solid #3d5a80;
    border-radius: 10px;
    background: #1a1a2e;
    color: #fff;
    outline: none;
    font-family: inherit;
}

input[type="text"]:focus, textarea:focus {
    border-color: #9b59b6;
}

textarea {
    width: 100%;
    min-height: 100px;
    resize: none;
    margin: 15px 0;
}

.char-count {
    text-align: right;
    color: #8892b0;
    font-size: 0.9rem;
    margin-bottom: 15px;
}

.btn {
    padding: 15px 25px;
    font-size: 1rem;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
    background: #3d5a80;
    color: #fff;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.btn-primary {
    background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
    color: #fff;
    width: 100%;
    margin-top: 20px;
}

.btn-secondary {
    background: #4a5568;
}

.btn-danger {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
    width: 100%;
    margin-top: 20px;
}

.btn-large {
    padding: 30px 50px;
    font-size: 1.3rem;
}

.btn-small {
    padding: 8px 12px;
    font-size: 12px;
}

#playerList {
    list-style: none;
    margin-bottom: 20px;
}

#playerList li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    margin-bottom: 8px;
}

#playerList li button {
    background: none;
    border: none;
    color: #ff6b6b;
    font-size: 1.2rem;
    cursor: pointer;
}

.rules {
    margin-top: 40px;
    padding: 20px;
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
}

.rules h3 {
    margin-bottom: 15px;
    color: #9b59b6;
}

.rules p {
    margin-bottom: 8px;
    color: #a0aec0;
}

.roles-info {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255,255,255,0.1);
}

.roles-info p {
    margin: 8px 0;
    font-size: 0.9rem;
}

/* Player name display */
.player-name {
    font-size: 2rem;
    text-align: center;
    color: #9b59b6;
    margin: 20px 0;
}

.word-container {
    text-align: center;
    margin: 40px 0;
}

.word-container.hidden {
    display: none;
}

.question-box {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 20px 0;
    padding: 25px;
    background: linear-gradient(135deg, rgba(155, 89, 182, 0.2) 0%, rgba(142, 68, 173, 0.2) 100%);
    border: 2px solid #9b59b6;
    border-radius: 15px;
    color: #fff;
    line-height: 1.4;
}

.hint {
    text-align: center;
    color: #8892b0;
    margin: 20px 0;
}

/* Player buttons for answering */
#playerButtons {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 20px 0;
}

.player-btn {
    padding: 20px;
    font-size: 1.1rem;
    font-weight: 600;
    border: 2px solid #3d5a80;
    border-radius: 15px;
    background: rgba(255,255,255,0.05);
    color: #fff;
    cursor: pointer;
    transition: all 0.2s;
}

.player-btn:hover:not(.done) {
    border-color: #9b59b6;
    background: rgba(155, 89, 182, 0.2);
}

.player-btn.done {
    border-color: #48c9b0;
    background: rgba(72, 201, 176, 0.2);
    cursor: default;
}

.player-btn.done::after {
    content: ' âœ“';
    color: #48c9b0;
}

/* Answers list */
.question-reveal {
    background: linear-gradient(135deg, rgba(155, 89, 182, 0.3) 0%, rgba(142, 68, 173, 0.3) 100%);
    border: 2px solid #9b59b6;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    text-align: center;
}

.question-reveal .label {
    color: #8892b0;
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.question-reveal .question {
    font-size: 1.3rem;
    font-weight: bold;
    color: #fff;
}

#answersList {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.answer-card {
    padding: 20px;
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    border-left: 4px solid #9b59b6;
}

.answer-card .player {
    font-weight: bold;
    color: #9b59b6;
    margin-bottom: 10px;
}

.answer-card .text {
    color: #e0e0e0;
    line-height: 1.5;
    font-size: 1.1rem;
}

/* Vote screen */
.player-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    margin-bottom: 10px;
    border: 2px solid transparent;
    transition: all 0.2s;
}

.player-card.voted {
    border-color: #ff6b6b;
    background: rgba(255, 107, 107, 0.15);
}

.vote-controls {
    display: flex;
    align-items: center;
    gap: 10px;
}

.vote-btn {
    width: 44px;
    height: 44px;
    border: none;
    border-radius: 50%;
    font-size: 1.3rem;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.vote-btn.plus {
    background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
    color: #fff;
}

.vote-btn.minus {
    background: rgba(255, 255, 255, 0.1);
    color: #8892b0;
}

.vote-btn:hover {
    transform: scale(1.1);
}

.vote-count {
    min-width: 30px;
    text-align: center;
    font-weight: bold;
}

.vote-counter {
    text-align: center;
    font-size: 1.3rem;
    color: #9b59b6;
    margin-bottom: 10px;
    padding: 10px;
    background: rgba(155, 89, 182, 0.1);
    border-radius: 10px;
}

.vote-instructions {
    text-align: center;
    color: #8892b0;
    margin-bottom: 20px;
    font-size: 0.9rem;
}

/* Results screen */
.reveal-box {
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.reveal-box .majority, .reveal-box .oddone {
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 10px;
}

.reveal-box .majority {
    background: rgba(72, 201, 176, 0.1);
    border-left: 4px solid #48c9b0;
}

.reveal-box .oddone {
    background: rgba(255, 107, 107, 0.1);
    border-left: 4px solid #ff6b6b;
}

.reveal-box .label {
    color: #8892b0;
    font-size: 0.9rem;
}

.reveal-box .question {
    font-size: 1.1rem;
    font-weight: bold;
    margin-top: 5px;
}

.reveal-box .player-name {
    font-size: 1rem;
    color: #ff6b6b;
    margin: 0;
}

#voteResults {
    margin: 20px 0;
}

.result-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    margin-bottom: 10px;
}

.result-row.winner {
    background: rgba(72, 201, 176, 0.2);
    border: 2px solid #48c9b0;
}

.result-row.oddone {
    background: rgba(255, 107, 107, 0.2);
    border: 2px solid #ff6b6b;
}

.result-row .name {
    font-weight: bold;
}

.result-row .votes {
    color: #8892b0;
}

.game-over-buttons {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 30px;
}

/* Pack Selection */
.pack-selection {
    margin: 25px 0;
    padding: 20px;
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
}

.pack-selection h4 {
    text-align: center;
    color: #9b59b6;
    margin-bottom: 15px;
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

#packOptions {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
}

.pack-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.95rem;
}

.pack-option:hover {
    background: rgba(255,255,255,0.1);
}

.pack-option input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #9b59b6;
}

/* Saved Teams */
.saved-teams {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
}

.saved-teams select {
    flex: 1;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #333;
    background: #1a1a2e;
    color: #fff;
    font-size: 14px;
}

.save-team-section {
    display: flex;
    gap: 8px;
    margin-top: 8px;
    margin-bottom: 16px;
}

.save-team-section input {
    flex: 1;
}

.btn-danger:not(.btn-primary) {
    background: #e74c3c;
    width: auto;
    margin-top: 0;
}

/* Mobile optimizations */
@media (max-width: 400px) {
    h1 { font-size: 2rem; }
    .player-name { font-size: 1.8rem; }
    .question-box { font-size: 1.2rem; padding: 20px; }
    #playerButtons { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
    <div id="app">
        <!-- Setup Screen -->
        <div id="setup" class="screen active">
            <h1>â“ Odd Question</h1>
            <p class="subtitle">Who Got the Different Question?</p>
            
            <!-- Saved Teams -->
            <div class="saved-teams" id="savedTeamsSection">
                <select id="savedTeams">
                    <option value="">ğŸ“‚ Load a saved team...</option>
                </select>
                <button id="deleteTeam" class="btn btn-small btn-danger" title="Delete selected team">ğŸ—‘ï¸</button>
            </div>

            <div class="player-input">
                <input type="text" id="playerName" placeholder="Enter player name" maxlength="20">
                <button id="addPlayer" class="btn">Add</button>
            </div>
            
            <ul id="playerList"></ul>
            <button id="clearPlayers" class="btn btn-small btn-secondary" style="display:none; margin-bottom: 16px;">ğŸ—‘ï¸ Clear All</button>
            
            <div class="save-team-section" id="saveTeamSection" style="display:none;">
                <input type="text" id="teamName" placeholder="Team name" maxlength="20">
                <button id="saveTeam" class="btn btn-small">ğŸ’¾ Save Team</button>
            </div>
            
            <div class="pack-selection">
                <h4>Question Categories</h4>
                <div id="packOptions"></div>
            </div>
            
            <button id="startGame" class="btn btn-primary" disabled>Start Game (3+ players)</button>
            
            <div class="rules">
                <h3>How to Play</h3>
                <p><strong>1.</strong> Everyone secretly sees a question</p>
                <p><strong>2.</strong> ONE player gets a different (but related) question</p>
                <p><strong>3.</strong> Everyone writes their answer</p>
                <p><strong>4.</strong> See all answers and vote for the odd one out!</p>
                <div class="roles-info">
                    <p>ğŸ‘¥ <strong>Majority</strong> â€” same question, find the faker</p>
                    <p>ğŸ•µï¸ <strong>Odd One Out</strong> â€” blend in with a similar answer!</p>
                </div>
            </div>
        </div>

        <!-- Answer Screen (tap your name) -->
        <div id="answer" class="screen">
            <h2>Tap your name to answer</h2>
            <p class="hint">Each player taps their button, sees their question, and enters their answer privately.</p>
            
            <div id="playerButtons"></div>
            
            <button id="showAnswers" class="btn btn-primary" disabled>Everyone Done? Show Answers</button>
        </div>

        <!-- Question Entry Screen (individual) -->
        <div id="question" class="screen">
            <h2 id="answeringPlayer" class="player-name"></h2>
            
            <div id="questionHidden" class="word-container">
                <button id="showQuestion" class="btn btn-large">ğŸ‘† Tap to see your question</button>
            </div>
            
            <div id="questionVisible" class="word-container hidden">
                <div class="question-box" id="questionDisplay"></div>
                <textarea id="answerInput" placeholder="Type your answer..." maxlength="150"></textarea>
                <div class="char-count"><span id="charCount">0</span>/150</div>
                <button id="submitAnswer" class="btn btn-primary">Submit & Pass Phone</button>
            </div>
        </div>

        <!-- Answers Reveal Screen -->
        <div id="answers" class="screen">
            <h2>ğŸ” The Answers</h2>
            <div class="question-reveal" id="questionReveal"></div>
            
            <div id="answersList"></div>
            
            <button id="startVote" class="btn btn-primary">Start Voting</button>
        </div>

        <!-- Vote Screen -->
        <div id="vote" class="screen">
            <h2>ğŸ—³ï¸ Who had a different question?</h2>
            
            <div id="votePlayers"></div>
            
            <button id="confirmVote" class="btn btn-danger">Reveal Results</button>
        </div>

        <!-- Results Screen -->
        <div id="results" class="screen">
            <h1 id="resultTitle"></h1>
            
            <div id="revealQuestions" class="reveal-box"></div>
            
            <div id="voteResults"></div>
            
            <div class="game-over-buttons">
                <button id="newRound" class="btn btn-primary">ğŸ”„ New Round (Same Players)</button>
                <button id="playAgain" class="btn btn-secondary">ğŸ‘‹ New Game (Reset Players)</button>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
<script>
const INLINE_QUESTIONS = 
{
  "packs": {
    "kids": "ğŸ‘¶ Kids Friendly",
    "adults": "ğŸ” Adults Only",
    "family": "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Family Fun"
  },
  "questions": [
    { "q1": "What's your favorite food?", "q2": "What did you last eat?", "pack": "kids" },
    { "q1": "What's your favorite animal?", "q2": "What animal scares you?", "pack": "kids" },
    { "q1": "What's your favorite color?", "q2": "What color is your room?", "pack": "kids" },
    { "q1": "What do you want to be when you grow up?", "q2": "What job would you never want?", "pack": "kids" },
    { "q1": "What's your favorite movie?", "q2": "What movie made you cry?", "pack": "kids" },
    { "q1": "What's your favorite game?", "q2": "What game are you bad at?", "pack": "kids" },
    { "q1": "What superpower would you want?", "q2": "What superpower would be useless?", "pack": "kids" },
    { "q1": "What's your favorite candy?", "q2": "What candy do you hate?", "pack": "kids" },
    { "q1": "Where would you travel?", "q2": "Where would you never go?", "pack": "kids" },
    { "q1": "What's your favorite subject in school?", "q2": "What subject is the hardest?", "pack": "kids" },
    { "q1": "What makes you happy?", "q2": "What makes you angry?", "pack": "kids" },
    { "q1": "What's your favorite cartoon?", "q2": "What cartoon is annoying?", "pack": "kids" },
    { "q1": "What toy do you want?", "q2": "What toy was disappointing?", "pack": "kids" },
    { "q1": "What's the best pizza topping?", "q2": "What topping is disgusting?", "pack": "kids" },
    { "q1": "What's your favorite holiday?", "q2": "What holiday is overrated?", "pack": "kids" },
    
    { "q1": "What's your hidden talent?", "q2": "What are you surprisingly bad at?", "pack": "family" },
    { "q1": "What's your dream vacation?", "q2": "Where would be your nightmare trip?", "pack": "family" },
    { "q1": "What would you do with a million dollars?", "q2": "What's a waste of money?", "pack": "family" },
    { "q1": "What's your comfort food?", "q2": "What food makes you sick?", "pack": "family" },
    { "q1": "What's your morning routine?", "q2": "What do you do before bed?", "pack": "family" },
    { "q1": "What's your favorite memory?", "q2": "What do you want to forget?", "pack": "family" },
    { "q1": "What makes you laugh?", "q2": "What's not funny to you?", "pack": "family" },
    { "q1": "What's your guilty pleasure?", "q2": "What do you judge others for?", "pack": "family" },
    { "q1": "What skill do you want to learn?", "q2": "What's a skill you gave up on?", "pack": "family" },
    { "q1": "What's your favorite season?", "q2": "What weather do you hate?", "pack": "family" },
    { "q1": "What celebrity would you meet?", "q2": "What celebrity is overrated?", "pack": "family" },
    { "q1": "What's your party trick?", "q2": "What embarrasses you at parties?", "pack": "family" },
    { "q1": "What's your favorite smell?", "q2": "What smell do you hate?", "pack": "family" },
    { "q1": "What would you rename yourself?", "q2": "What name do you dislike?", "pack": "family" },
    { "q1": "What's your weekend hobby?", "q2": "What hobby is boring?", "pack": "family" },
    
    { "q1": "What's your worst habit?", "q2": "What habit annoys you in others?", "pack": "adults" },
    { "q1": "What's your biggest regret?", "q2": "What would you do again?", "pack": "adults" },
    { "q1": "What keeps you up at night?", "q2": "What do you daydream about?", "pack": "adults" },
    { "q1": "What's your toxic trait?", "q2": "What red flag do you ignore?", "pack": "adults" },
    { "q1": "What lie do you tell often?", "q2": "What truth do you hide?", "pack": "adults" },
    { "q1": "What's your drunk confession?", "q2": "What secret would you never tell sober?", "pack": "adults" },
    { "q1": "What's your dealbreaker in dating?", "q2": "What have you settled for?", "pack": "adults" },
    { "q1": "What's your guilty pleasure show?", "q2": "What show do you hate-watch?", "pack": "adults" },
    { "q1": "What would you do if no one judged you?", "q2": "What do you judge others for doing?", "pack": "adults" },
    { "q1": "What's your worst date story?", "q2": "What's your best pickup line?", "pack": "adults" },
    { "q1": "What's overrated about adulting?", "q2": "What do you miss about being young?", "pack": "adults" },
    { "q1": "What's your hangover cure?", "q2": "What drink do you regret?", "pack": "adults" },
    { "q1": "What's your unpopular opinion?", "q2": "What popular thing do you hate?", "pack": "adults" },
    { "q1": "What relationship mistake did you learn from?", "q2": "What mistake will you make again?", "pack": "adults" },
    { "q1": "What's the pettiest thing you've done?", "q2": "What grudge do you still hold?", "pack": "adults" }
  ]
}
;
// Odd Question Out - Party Game

let allQuestions = [];
let filteredQuestions = [];
let packs = {};
let selectedPacks = new Set(['kids', 'family']);
let players = [];
let gameState = {
    majorityQuestion: '',
    oddQuestion: '',
    oddPlayerIndex: -1,
    answers: {},
    votes: {},
    currentAnsweringPlayer: -1
};

// Load questions
Promise.resolve(INLINE_QUESTIONS)
    
    .then(data => {
        allQuestions = data.questions;
        packs = data.packs || {};
        renderPackOptions();
        filterQuestions();
    })
    .catch(() => {
        // Fallback
        allQuestions = [
            { q1: "What's your favorite food?", q2: "What food do you hate?", pack: "kids" }
        ];
        packs = { kids: 'ğŸ‘¶ Kids Friendly' };
        renderPackOptions();
        filterQuestions();
    });

function renderPackOptions() {
    const container = document.getElementById('packOptions');
    if (!container) return;
    
    container.innerHTML = Object.entries(packs).map(([key, label]) => `
        <label class="pack-option">
            <input type="checkbox" value="${key}" ${selectedPacks.has(key) ? 'checked' : ''} onchange="togglePack('${key}')">
            ${label}
        </label>
    `).join('');
}

function togglePack(packKey) {
    if (selectedPacks.has(packKey)) {
        selectedPacks.delete(packKey);
    } else {
        selectedPacks.add(packKey);
    }
    filterQuestions();
}

function filterQuestions() {
    filteredQuestions = allQuestions.filter(q => selectedPacks.has(q.pack));
    updateStartButton();
}

window.togglePack = togglePack;

// DOM Elements
const screens = {
    setup: document.getElementById('setup'),
    answer: document.getElementById('answer'),
    question: document.getElementById('question'),
    answers: document.getElementById('answers'),
    vote: document.getElementById('vote'),
    results: document.getElementById('results')
};

// Setup elements
const playerNameInput = document.getElementById('playerName');
const addPlayerBtn = document.getElementById('addPlayer');
const playerList = document.getElementById('playerList');
const startGameBtn = document.getElementById('startGame');

// Answer selection elements
const playerButtonsEl = document.getElementById('playerButtons');
const showAnswersBtn = document.getElementById('showAnswers');

// Question entry elements
const answeringPlayerEl = document.getElementById('answeringPlayer');
const questionHiddenEl = document.getElementById('questionHidden');
const questionVisibleEl = document.getElementById('questionVisible');
const showQuestionBtn = document.getElementById('showQuestion');
const questionDisplayEl = document.getElementById('questionDisplay');
const answerInput = document.getElementById('answerInput');
const charCountEl = document.getElementById('charCount');
const submitAnswerBtn = document.getElementById('submitAnswer');

// Answers reveal elements
const questionRevealEl = document.getElementById('questionReveal');
const answersListEl = document.getElementById('answersList');
const startVoteBtn = document.getElementById('startVote');

// Vote elements
const votePlayersEl = document.getElementById('votePlayers');
const confirmVoteBtn = document.getElementById('confirmVote');

// Results elements
const resultTitleEl = document.getElementById('resultTitle');
const revealQuestionsEl = document.getElementById('revealQuestions');
const voteResultsEl = document.getElementById('voteResults');
const newRoundBtn = document.getElementById('newRound');
const playAgainBtn = document.getElementById('playAgain');

// Helper functions
function showScreen(name) {
    Object.values(screens).forEach(s => s.classList.remove('active'));
    screens[name].classList.add('active');
}

function shuffle(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function updateStartButton() {
    const btn = document.getElementById('startGame');
    if (players.length < 3) {
        btn.disabled = true;
        btn.textContent = `Start Game (${3 - players.length} more needed)`;
    } else if (filteredQuestions.length === 0) {
        btn.disabled = true;
        btn.textContent = 'Select at least one category!';
    } else {
        btn.disabled = false;
        btn.textContent = `Start Game (${players.length} players)`;
    }
}

function updatePlayerList() {
    playerList.innerHTML = players.map((p, i) => `
        <li>
            ${p.name}
            <button onclick="removePlayer(${i})">âœ•</button>
        </li>
    `).join('');
    updateStartButton();
}

function removePlayer(index) {
    players.splice(index, 1);
    updatePlayerList();
}

function addPlayer() {
    const name = playerNameInput.value.trim();
    if (name && !players.find(p => p.name.toLowerCase() === name.toLowerCase())) {
        players.push({ name, question: null, answer: '' });
        playerNameInput.value = '';
        updatePlayerList();
    }
    playerNameInput.focus();
}

function assignQuestions() {
    if (filteredQuestions.length === 0) {
        alert('No questions available! Select at least one category.');
        return false;
    }
    
    // Pick a random question pair
    const pair = filteredQuestions[Math.floor(Math.random() * filteredQuestions.length)];
    
    // Randomly decide which question is majority vs odd
    if (Math.random() > 0.5) {
        gameState.majorityQuestion = pair.q1;
        gameState.oddQuestion = pair.q2;
    } else {
        gameState.majorityQuestion = pair.q2;
        gameState.oddQuestion = pair.q1;
    }
    
    // Pick one player to be the odd one out
    gameState.oddPlayerIndex = Math.floor(Math.random() * players.length);
    
    // Assign questions
    players.forEach((p, i) => {
        p.question = (i === gameState.oddPlayerIndex) ? gameState.oddQuestion : gameState.majorityQuestion;
        p.answer = '';
    });
    
    gameState.answers = {};
    gameState.votes = {};
    return true;
}

function renderPlayerButtons() {
    playerButtonsEl.innerHTML = players.map((p, i) => `
        <button class="player-btn ${p.answer ? 'done' : ''}" 
                onclick="startAnswering(${i})" 
                ${p.answer ? 'disabled' : ''}>
            ${p.name}
        </button>
    `).join('');
    
    const allDone = players.every(p => p.answer);
    showAnswersBtn.disabled = !allDone;
}

function startAnswering(index) {
    gameState.currentAnsweringPlayer = index;
    answeringPlayerEl.textContent = players[index].name;
    questionHiddenEl.classList.remove('hidden');
    questionVisibleEl.classList.add('hidden');
    answerInput.value = '';
    charCountEl.textContent = '0';
    showScreen('question');
}

function renderAnswers() {
    // Show the majority question
    questionRevealEl.innerHTML = `
        <div class="label">The Question:</div>
        <div class="question">${gameState.majorityQuestion}</div>
    `;
    
    // Shuffle answers for display
    const shuffled = shuffle(players.map((p, i) => ({ ...p, index: i })));
    
    answersListEl.innerHTML = shuffled.map(p => `
        <div class="answer-card">
            <div class="player">${p.name}</div>
            <div class="text">"${p.answer || '(no answer)'}"</div>
        </div>
    `).join('');
}

function renderVotePlayers() {
    gameState.votes = {};
    
    votePlayersEl.innerHTML = `
        <div class="vote-counter" id="voteCounter">Votes: 0 / ${players.length}</div>
        <p class="vote-instructions">Each player votes for who they think had a different question.</p>
        ${players.map((p, i) => `
            <div class="player-card" data-index="${i}">
                <span class="name">${p.name}</span>
                <div class="vote-controls">
                    <button class="vote-btn minus" onclick="removeVote(${i})">â–</button>
                    <span class="vote-count" id="votes-${i}"></span>
                    <button class="vote-btn plus" onclick="addVote(${i})">â•</button>
                </div>
            </div>
        `).join('')}
    `;
}

function addVote(index) {
    const totalVotes = Object.values(gameState.votes).reduce((a, b) => a + b, 0);
    if (totalVotes >= players.length) return;
    
    gameState.votes[index] = (gameState.votes[index] || 0) + 1;
    updateVoteDisplay();
}

function removeVote(index) {
    if (gameState.votes[index] && gameState.votes[index] > 0) {
        gameState.votes[index]--;
        if (gameState.votes[index] === 0) delete gameState.votes[index];
    }
    updateVoteDisplay();
}

function updateVoteDisplay() {
    const totalVotes = Object.values(gameState.votes).reduce((a, b) => a + b, 0);
    document.getElementById('voteCounter').textContent = `Votes: ${totalVotes} / ${players.length}`;
    
    document.querySelectorAll('#votePlayers .player-card').forEach(card => {
        const idx = parseInt(card.dataset.index);
        const count = gameState.votes[idx] || 0;
        document.getElementById(`votes-${idx}`).textContent = count > 0 ? `ğŸ‘† ${count}` : '';
        card.classList.toggle('voted', count > 0);
    });
}

function showResults() {
    // Find who got most votes
    let maxVotes = 0;
    let mostVoted = -1;
    for (const [idx, votes] of Object.entries(gameState.votes)) {
        if (votes > maxVotes) {
            maxVotes = votes;
            mostVoted = parseInt(idx);
        }
    }
    
    const foundOddOne = mostVoted === gameState.oddPlayerIndex;
    const oddPlayer = players[gameState.oddPlayerIndex];
    
    resultTitleEl.textContent = foundOddOne ? 'ğŸ‰ Majority Wins!' : 'ğŸ•µï¸ Odd One Out Wins!';
    
    revealQuestionsEl.innerHTML = `
        <div class="majority">
            <div class="label">Majority Question:</div>
            <div class="question">${gameState.majorityQuestion}</div>
        </div>
        <div class="oddone">
            <div class="label">${oddPlayer.name}'s Question:</div>
            <div class="question">${gameState.oddQuestion}</div>
        </div>
    `;
    
    // Show vote breakdown
    const sortedPlayers = [...players].map((p, i) => ({ ...p, index: i, votes: gameState.votes[i] || 0 }))
        .sort((a, b) => b.votes - a.votes);
    
    voteResultsEl.innerHTML = sortedPlayers.map(p => {
        const isOdd = p.index === gameState.oddPlayerIndex;
        const isTopVoted = p.votes === maxVotes && maxVotes > 0;
        let classes = 'result-row';
        if (isOdd) classes += ' oddone';
        else if (isTopVoted && foundOddOne) classes += ' winner';
        
        return `
            <div class="${classes}">
                <span class="name">${p.name} ${isOdd ? 'ğŸ•µï¸' : ''}</span>
                <span class="votes">${p.votes} vote${p.votes !== 1 ? 's' : ''}</span>
            </div>
        `;
    }).join('');
    
    showScreen('results');
}

// Event Listeners
addPlayerBtn.addEventListener('click', addPlayer);
playerNameInput.addEventListener('keypress', e => {
    if (e.key === 'Enter') addPlayer();
});

startGameBtn.addEventListener('click', () => {
    saveLastPlayers();
    if (!assignQuestions()) return;
    renderPlayerButtons();
    showScreen('answer');
});

showQuestionBtn.addEventListener('click', () => {
    const player = players[gameState.currentAnsweringPlayer];
    questionHiddenEl.classList.add('hidden');
    questionVisibleEl.classList.remove('hidden');
    questionDisplayEl.textContent = player.question;
});

answerInput.addEventListener('input', () => {
    charCountEl.textContent = answerInput.value.length;
});

submitAnswerBtn.addEventListener('click', () => {
    const answer = answerInput.value.trim();
    if (!answer) {
        alert('Please enter an answer!');
        return;
    }
    
    players[gameState.currentAnsweringPlayer].answer = answer;
    renderPlayerButtons();
    showScreen('answer');
});

showAnswersBtn.addEventListener('click', () => {
    renderAnswers();
    showScreen('answers');
});

startVoteBtn.addEventListener('click', () => {
    renderVotePlayers();
    showScreen('vote');
});

confirmVoteBtn.addEventListener('click', () => {
    const totalVotes = Object.values(gameState.votes).reduce((a, b) => a + b, 0);
    if (totalVotes === 0) {
        alert('Cast at least one vote!');
        return;
    }
    showResults();
});

newRoundBtn.addEventListener('click', () => {
    players.forEach(p => {
        p.question = null;
        p.answer = '';
    });
    gameState = {
        majorityQuestion: '',
        oddQuestion: '',
        oddPlayerIndex: -1,
        answers: {},
        votes: {},
        currentAnsweringPlayer: -1
    };
    if (!assignQuestions()) {
        showScreen('setup');
        return;
    }
    renderPlayerButtons();
    showScreen('answer');
});

playAgainBtn.addEventListener('click', () => {
    players = [];
    gameState = {
        majorityQuestion: '',
        oddQuestion: '',
        oddPlayerIndex: -1,
        answers: {},
        votes: {},
        currentAnsweringPlayer: -1
    };
    updatePlayerList();
    showScreen('setup');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-SAVE LAST PLAYERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LAST_PLAYERS_KEY = 'oddquestion_last_players';

function saveLastPlayers() {
    if (players.length >= 3) {
        localStorage.setItem(LAST_PLAYERS_KEY, JSON.stringify(players.map(p => p.name)));
    }
}

function loadLastPlayers() {
    try {
        const saved = JSON.parse(localStorage.getItem(LAST_PLAYERS_KEY));
        if (saved && saved.length >= 3) {
            players = saved.map(name => ({ name, question: null, answer: '' }));
            updatePlayerList();
        }
    } catch {}
}

document.getElementById('clearPlayers')?.addEventListener('click', () => {
    players = [];
    localStorage.removeItem(LAST_PLAYERS_KEY);
    updatePlayerList();
});

loadLastPlayers();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEAM SAVE/LOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TEAMS_KEY = 'oddquestion_saved_teams';

function getSavedTeams() {
    try {
        return JSON.parse(localStorage.getItem(TEAMS_KEY)) || {};
    } catch { return {}; }
}

function saveTeamsToStorage(teams) {
    localStorage.setItem(TEAMS_KEY, JSON.stringify(teams));
}

function renderSavedTeams() {
    const teams = getSavedTeams();
    const select = document.getElementById('savedTeams');
    const teamNames = Object.keys(teams);
    
    select.innerHTML = '<option value="">ğŸ“‚ Load a saved team...</option>' +
        teamNames.map(name => `<option value="${name}">${name} (${teams[name].length})</option>`).join('');
    
    document.getElementById('savedTeamsSection').style.display = teamNames.length > 0 ? 'flex' : 'none';
}

function saveCurrentTeam() {
    const nameInput = document.getElementById('teamName');
    const teamName = nameInput.value.trim();
    
    if (!teamName) { alert('Enter a team name'); return; }
    if (players.length < 2) { alert('Add at least 2 players first'); return; }
    
    const teams = getSavedTeams();
    teams[teamName] = players.map(p => p.name);
    saveTeamsToStorage(teams);
    nameInput.value = '';
    renderSavedTeams();
}

function loadTeam(teamName) {
    if (!teamName) return;
    const teams = getSavedTeams();
    const teamPlayers = teams[teamName];
    if (teamPlayers) {
        players = teamPlayers.map(name => ({ name, question: null, answer: '' }));
        updatePlayerList();
    }
    document.getElementById('savedTeams').value = '';
}

function deleteSelectedTeam() {
    const select = document.getElementById('savedTeams');
    const teamName = select.value;
    if (!teamName) { alert('Select a team to delete'); return; }
    if (confirm(`Delete team "${teamName}"?`)) {
        const teams = getSavedTeams();
        delete teams[teamName];
        saveTeamsToStorage(teams);
        renderSavedTeams();
    }
}

document.getElementById('savedTeams')?.addEventListener('change', e => loadTeam(e.target.value));
document.getElementById('saveTeam')?.addEventListener('click', saveCurrentTeam);
document.getElementById('deleteTeam')?.addEventListener('click', deleteSelectedTeam);
document.getElementById('teamName')?.addEventListener('keypress', e => {
    if (e.key === 'Enter') saveCurrentTeam();
});

// Show buttons when players exist
const origUpdatePlayerList = updatePlayerList;
updatePlayerList = function() {
    origUpdatePlayerList();
    const saveSection = document.getElementById('saveTeamSection');
    const clearBtn = document.getElementById('clearPlayers');
    if (saveSection) saveSection.style.display = players.length >= 2 ? 'flex' : 'none';
    if (clearBtn) clearBtn.style.display = players.length > 0 ? 'block' : 'none';
};

renderSavedTeams();

// Globals
window.removePlayer = removePlayer;
window.addVote = addVote;
window.removeVote = removeVote;
window.loadTeam = loadTeam;
window.startAnswering = startAnswering;
</script>
</body>
</html>
